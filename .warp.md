# AFFiNE Project Development Rules

## Project Overview
AFFiNE is an open-source, local-first, privacy-focused alternative to Notion & Miro. It's a hyper-fused platform combining docs, canvas, and tables in one unified workspace. The project uses a monorepo structure with multiple packages and workspaces.

## Package Manager & Node.js
- **Use Yarn 4.9.1** as the primary package manager (configured via `packageManager` in package.json)
- Node.js version must be **< 23.0.0** (specified in engines)
- Use `.nvmrc` for Node.js version consistency across team members

## Development Commands
- `yarn dev` or `yarn affine dev` - Start development server
- `yarn build` or `yarn affine build` - Build the project
- `yarn test` - Run tests with Vitest
- `yarn test:ui` - Run tests with UI
- `yarn typecheck` - Run TypeScript type checking
- `yarn lint` - Run ESLint and Prettier checks
- `yarn lint:fix` - Fix linting issues automatically

## Code Quality & Standards

### TypeScript
- TypeScript 5.7.2+ required
- Strict TypeScript configuration across all packages
- Use proper type annotations and avoid `any` types
- Multiple tsconfig files for different contexts (web, node, eslint)

### Linting & Formatting
- **ESLint 9.16.0+** with TypeScript integration
- **Prettier 3.4.2+** for code formatting
- **Oxlint** for additional fast linting
- Automated formatting with lint-staged and Husky pre-commit hooks
- Configuration files: `eslint.config.mjs`, `.prettierrc`, `oxlint.json`

### Code Style Guidelines
- Use TypeScript strict mode
- Prefer functional components with hooks in React
- Use proper import sorting (eslint-plugin-simple-import-sort)
- Follow React hooks rules (eslint-plugin-react-hooks)
- Use unicorn plugin conventions for modern JavaScript

## Testing
- **Vitest 3.1.3** as the primary testing framework
- Happy DOM for browser environment simulation
- Coverage reports with Istanbul
- MSW (Mock Service Worker) for API mocking
- Playwright for E2E testing
- Test files should be co-located with source code or in dedicated test directories

## Architecture & Structure

### Monorepo Structure
- Root-level packages in `packages/*/*`
- Frontend apps in `packages/frontend/apps/*`
- BlockSuite integration in `blocksuite/**/*`
- Tools and utilities in `tools/*`
- Documentation in `docs/`
- Tests in `tests/*`

### Key Technologies
- **React** - UI library
- **Electron** - Desktop application
- **Vite** - Build tool and dev server
- **Jotai** - State management
- **BlockSuite** - Collaborative editor engine
- **OctoBase** - Local-first database
- **Y.js** - CRDT for real-time collaboration

## Git & Version Control
- Use Husky for Git hooks
- Lint-staged runs on pre-commit
- Conventional commit messages preferred
- Feature branches should be created from main
- Keep commits atomic and descriptive

## Environment & Configuration
- Use `.editorconfig` for consistent editor settings
- Docker support available in `.docker/`
- VSCode settings in `.vscode/`
- Development container configuration in `.devcontainer/`

## Dependencies & Package Management
- Extensive nolyfill resolutions to reduce bundle size
- Patch files for specific package modifications (`.yarn/patches/`)
- Workspace protocol for internal dependencies (`workspace:*`)
- Careful dependency management with lockfile commit requirements

## Performance & Build
- SWC for fast TypeScript compilation
- Vanilla Extract for CSS-in-JS
- Code splitting and lazy loading strategies
- Bundle analysis and optimization
- Memory optimization flags for large builds (`--max-old-space-size=8192`)

## Security & Privacy
- Local-first architecture principles
- Privacy-focused development practices
- Security audits and vulnerability scanning
- Minimal external dependencies where possible

## Documentation
- Comprehensive README with contribution guidelines
- TypeDoc for API documentation
- Contributing guidelines in `docs/CONTRIBUTING.md`
- Self-hosting documentation available

## Special Considerations
- Multi-platform support (Web, Desktop, Mobile)
- Real-time collaboration features
- Offline-first functionality
- Plugin system architecture (upcoming)
- I18n support for multiple languages
- Accessibility compliance

## Development Workflow
1. Install dependencies: `yarn install`
2. Run initialization: `yarn affine init` (runs automatically via postinstall)
3. Start development: `yarn dev`
4. Run tests: `yarn test`
5. Check types: `yarn typecheck`
6. Lint code: `yarn lint`
7. Build for production: `yarn build`

## Contributing
- Read and accept the Contributor License Agreement
- Follow the established coding standards
- Write tests for new features
- Update documentation as needed
- Participate in code reviews
- Use the appropriate issue templates for bugs and features

## Community
- Discord for real-time communication
- GitHub Discussions for longer-form discussions
- Community forum at community.affine.pro
- Regular community calls and updates
